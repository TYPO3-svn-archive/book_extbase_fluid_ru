<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xmlns="http://docbook.org/ns/docbook"
         xmlns:xl="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xhtml="http://www.w3.org/1999/xhtml"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:ns="http://docbook.org/ns/docbook"
         xmlns:mathml="http://www.w3.org/1998/Math/MathML">
  <title>Отладка при помощи Xdebug</title>

  <para>Хотя использование отдельных отладчиков в других языках
  программирования является частью рабочего процесса, в PHP это встречается не
  часто, большинство разработчиков предпочитают работать над исправлением
  ошибок по ходу – встраивая в код <code>echo</code> или
  <constant>var_dump</constant>, и по выводимому результату пытаются понять
  ошибки по ходу выполнения программы. В сложных же проектах для просмотра
  ошибок как никогда полезны отладчики, которые могут последовательно
  выполнять код и отслеживать, например, значения переменных.</para>

  <para>Для включения отладки понадобиться расширение PHP Xdebug (<link
  xl:href="???">http:// xdebug.org</link>). Это расширение PHP, позволяющее
  последовательно выполнять команды PHP и отслеживать состояние переменных.
  Среды разработки NetBeans и Eclipse имеют поддержку Xdebug, включая
  графическое представление отладки.</para>

  <para>Но сначала вернёмся к самому Xdebug. Это расширение PHP может быть
  установлено различными способами, мы рекомендуем либо пакетную установку
  (например, APT для Debian/Ubuntu или MacPorts для Mac OS X), либо установку
  PECL (PHP Extension Community Library). Последний вариант должен быть
  запущен из консоли (пользователем <emphasis>root</emphasis>) следующей
  командой:</para>

  <programlisting>pecl install xdebug</programlisting>

  <para>После успешной установки Xdebug, нужно активировать его в PHP. Для
  этого в файле <filename>php.ini</filename> нужно добавить следующую
  строку:</para>

  <para><code>zend_extension="/usr/local/php/modules/xdebug.so"</code></para>

  <para>Здесь нужно указать правильный путь к файлу
  <filename>xdebug.so</filename>.</para>

  <note>
    <para>Для Windows на официальном сайте доступны для загрузки готовые
    версии Xdebug.</para>
  </note>

  <para>После перезапуска Apache, в выводе из <function>phpinfo()</function>
  должен появиться раздел Xdebug. Теперь нужно настроить XDebug для совместной
  работы с Eclipse или NetBeans. Для того, чтобы соединить отладчик с NetBeans
  или Eclipse необходимо добавить следующие строчки в файл настроек
  <filename>php.ini</filename>:</para>

  <programlisting>xdebug.remote_enable=on
xdebug.remote_handler=dbgp
xdebug.remote_host=localhost
xdebug.remote_port=9000</programlisting>

  <para>Снова перезагрузив Apache, приведённые выше значения должны появиться
  в информации, выводимой через <function>phpinfo()</function>. Теперь, для
  корректного вызова Xdebug, нужно дополнительно настроить среду разработки.
  Для NetBeans нужно щёлкнуть правой кнопки мыши на названии проекта, и в
  контекстном меню выбрать <emphasis>Свойства</emphasis>. Здесь предстоит
  изменить <emphasis>Настройки выполнения</emphasis>: в строке <emphasis>URL
  адрес проекта</emphasis> введите URL внешнего интерфейса TYPO3 под которым
  работает локальная система, например:
  <emphasis>http://localhost/typo3v4/</emphasis>. Затем щёлкните по кнопке
  <emphasis>Дополнительно</emphasis>..., и в параметрах <emphasis>URL адрес
  отладки</emphasis> установите <emphasis>Спрашивать каждый раз</emphasis>.
  NetBeans готов к отладке.</para>

  <para>Теперь в исходный код можно помещать так называемые точки останова. В
  них выполнение программы прерывается, и можно посмотреть состояние
  программы, например значение переменных или запускать программу построчно.
  Для установки точки останова щёлкните по номеру строки в исходном коде,
  после чего строка будет выделена красным.</para>

  <para>Для начала отладки, выберете в меню <emphasis>Отладка ➝ Отладка
  проекта</emphasis>. При этом будет открыто окно, где необходимо будет ввести
  URL. Желательно скопировать его непосредственно из адресной строки браузера:
  для, например, отладки модуля сетевого журнала, откройте модуль Blog во
  внутреннем интерфейсе TYPO3, щёлкните правой кнопкой мыши во фрейме с
  загруженным модулем и выберете <emphasis>Текущий фрейм ➝ Открыть фрейм в
  новой вкладке</emphasis>. Скопируйте URL этого фрейма и вставьте в диалоге
  NetBeans и нажмите OK. NetBeans откроет браузер на странице с введённом URL.
  Вернувшись в NetBeans можно заметить, что включён режим отладки, и NetBeans
  остановил выполнение в установленной точке останова. Теперь можно проверить
  содержимое интересующей нас переменной, выполнить следующий шаг программы,
  что позволит быстрее отладить программу.</para>

  <note>
    <para>рекомендуется отключить параметр NetBeans <emphasis>PHP ➝ Отладка ➝
    Останавливаться на первой строке</emphasis>, чтобы программа
    останавливалась только в определённых точках останова.</para>
  </note>

  <para>Теперь перейдём к настройке отладки в Eclipse. Перейдите к параметрам
  Eclipse и откройте раздел <emphasis>PHP ➝ PHP Servers</emphasis> и создайте
  запись <emphasis>http://localhost</emphasis>. В разделе <emphasis>PHP ➝
  Debug</emphasis> параметр <emphasis>PHP Debugger</emphasis> должен быть
  установлен на <emphasis>XDebug</emphasis>, а <emphasis>Server</emphasis>
  должен быть указан только что созданный сервер localhost. Опять же, мы
  рекомендуем снять настройку <emphasis>Break at First Line</emphasis>, чтобы
  отладчик останавливался лишь в определённых точках останова.</para>

  <para>Установить точки останова можно, сделав двойной щелчок слева от нужной
  строки в редакторе исходного кода. Запустите отладчик, щёлкнув правой
  кнопкой мыши на нужном файле и выбрав в контекстном меню <emphasis>Debug as
  ➝ PHP Web Page</emphasis>. В диалоговом окне нужно ввести URL, как было
  описано выше.</para>

  <para>Теперь перейдите в перспективу PHP-Debug, где можете начать отладку.
  Опять же, возможно просматривать содержимое переменных и выполнять программу
  последовательно. Остановить отладку можно, выбрав в меню <emphasis>Run ➝
  Terminate</emphasis>.</para>

  <note>
    <para>при повторном запуске отладчика не последует запроса URL. Так
    произошло, потому что при первом запуске Eclipse создаёт так называемую
    <emphasis>Настройку отладки</emphasis>, где (среди прочего) хранится и
    введённый URL. Если нужно изменить URL, то сделать это можно в разделе
    настроек <emphasis>Run ➝ Debug Configurations</emphasis>.</para>
  </note>

  <para>Отладка при помощи IDE позволяет быстро и просто найти ошибки. Хотя
  отладчик для PHP и не столь сложен, как его коллеги для Java, но поиск
  ошибок существенно упрощается.</para>
</section>
